/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var se=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var xe=Object.prototype.hasOwnProperty;var ne=(f,s)=>()=>(f&&(s=f(f=0)),s);var ie=(f,s)=>{for(var e in s)se(f,e,{get:s[e],enumerable:!0})},Le=(f,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of ke(s))!xe.call(f,n)&&n!==e&&se(f,n,{get:()=>s[n],enumerable:!(t=Se(s,n))||t.enumerable});return f};var be=f=>Le(se({},"__esModule",{value:!0}),f);var L,re=ne(()=>{L=class{static getAllPathsFromTasks(s){let e=new Set;s.forEach(n=>{let o=n.path.split("/");if(o.length>1)for(let a=1;a<o.length;a++){let r=o.slice(0,a).join("/");e.add(r)}});let t=Array.from(e);return t.sort((n,i)=>n.localeCompare(i)),t}static async getAllPaths(s){let e=[];return s.getMarkdownFiles().forEach(n=>{let o=n.path.split("/");if(o.length>1)for(let a=1;a<o.length;a++){let r=o.slice(0,a).join("/");e.includes(r)||e.push(r)}}),e.sort((n,i)=>n.localeCompare(i)),e}static getAllFilesFromTasks(s){let e=new Set;s.forEach(n=>{let i=n.path.split("/"),o=i[i.length-1];e.add(o)});let t=Array.from(e);return t.sort((n,i)=>n.localeCompare(i)),t}static async getAllFiles(s){let e=[];return s.getMarkdownFiles().forEach(n=>{let i=n.name;e.includes(i)||e.push(i)}),e.sort((n,i)=>n.localeCompare(i)),e}static getAllTags(s){let e=new Set,t=/#([^\s\)\]\}\>]+)/g;s.forEach(o=>{if(o.rawText){let a;for(;(a=t.exec(o.rawText))!==null;){let r=a[1];e.add(r)}}});let i=Array.from(e).filter(o=>!["A","B","C"].includes(o));return i.sort((o,a)=>o.localeCompare(a)),i}static getAllStates(s){let e=["TODO","DOING","DONE","NOW","LATER","WAIT","WAITING","IN-PROGRESS","CANCELED","CANCELLED"],t=(s==null?void 0:s.additionalTaskKeywords)||[];return Array.from(new Set([...e,...t])).sort((i,o)=>i.localeCompare(o))}static getPriorityOptions(){return["A","B","C","high","medium","low","none"]}static getDateSuggestions(){return["overdue","due","today","tomorrow","this week","next week","this month","next month","next 7 days","none"]}static getScheduledDateSuggestions(s){let e=new Set;s.forEach(n=>{if(n.scheduledDate){let i=n.scheduledDate.toISOString().split("T")[0];e.add(i)}});let t=Array.from(e);return t.sort((n,i)=>n.localeCompare(i)),t}static getDeadlineDateSuggestions(s){let e=new Set;s.forEach(n=>{if(n.deadlineDate){let i=n.deadlineDate.toISOString().split("T")[0];e.add(i)}});let t=Array.from(e);return t.sort((n,i)=>n.localeCompare(i)),t}static filterSuggestions(s,e){if(!s)return e;let t=s.toLowerCase();return e.filter(n=>n.toLowerCase().includes(t))}static clearCache(){}}});var de={};ie(de,{SearchOptionsDropdown:()=>oe});var oe,ue=ne(()=>{re();oe=class{constructor(s,e,t,n,i){this.suggestionDropdown=i;this.currentSuggestions=[];this.selectedIndex=-1;this.isShowing=!1;this.isHandlingPrefixSelection=!1;this.inputEl=s,this.vault=e,this.tasks=t,this.settings=n,this.containerEl=document.createElement("div"),this.containerEl.style.position="absolute",this.containerEl.style.zIndex="1000",this.containerEl.style.display="none",document.body.appendChild(this.containerEl),this.updateWidth(),this.setupEventListeners()}updateTasks(s){this.tasks=s}setupEventListeners(){document.addEventListener("click",s=>{let e=s.target;this.containerEl.contains(e)||e!==this.inputEl&&(this.isHandlingPrefixSelection||this.hide())}),this.inputEl.addEventListener("blur",()=>{requestAnimationFrame(()=>{this.isHandlingPrefixSelection||this.hide()})}),window.addEventListener("resize",()=>{this.updateWidth()}),window.addEventListener("scroll",()=>{this.updatePosition()},{passive:!0})}updateWidth(){let s=this.inputEl.getBoundingClientRect();this.containerEl.style.width=`${s.width}px`}updatePosition(){let s=this.inputEl.getBoundingClientRect(),e=window.scrollX+s.left,t=window.scrollY+s.bottom+2;this.containerEl.style.left=`${e}px`,this.containerEl.style.top=`${t}px`}async showOptionsDropdown(s=""){let e=["path:","file:","tag:","state:","priority:","content:","scheduled:","deadline:"];s?this.currentSuggestions=L.filterSuggestions(s,e):this.currentSuggestions=e,await this.renderDropdown(),this.show()}async renderDropdown(){this.containerEl.innerHTML="";let e=this.containerEl.createEl("div",{cls:"suggestion-container mod-search-suggestion",attr:{style:"width: 300px;"}}).createEl("div",{cls:"suggestion"});if(this.currentSuggestions.length===0)return;let t=e.createEl("div",{cls:"suggestion-item mod-complex search-suggest-item mod-group"});t.createEl("div",{cls:"suggestion-content"}).createEl("div",{cls:"suggestion-title list-item-part mod-extended"}).createSpan({text:"Search options"});let a=t.createEl("div",{cls:"suggestion-aux"}).createEl("div",{cls:"list-item-part search-suggest-icon clickable-icon",attr:{"aria-label":"Read more"}});a.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" class="svg-icon lucide-info">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 16v-4"></path>
                <path d="M12 8h.01"></path>
            </svg>
        `,this.currentSuggestions.forEach((r,l)=>{let c=e.createEl("div",{cls:`suggestion-item mod-complex search-suggest-item ${l===this.selectedIndex?"is-selected":""}`}),g=c.createEl("div",{cls:"suggestion-content"}).createEl("div",{cls:"suggestion-title"});g.createSpan({text:r});let u=this.getPrefixDescription(r);u&&g.createSpan({cls:"search-suggest-info-text",text:` ${u}`}),c.addEventListener("mousedown",p=>{p.preventDefault(),r.endsWith(":")&&!r.includes(" ")&&(this.isHandlingPrefixSelection=!0),this.handleSelection(r)}),c.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation()}),c.addEventListener("mouseover",()=>{this.selectedIndex=l,this.updateSelection()})})}getPrefixDescription(s){switch(s){case"path:":return"match path of the file";case"file:":return"match file name";case"tag:":return"search for tags";case"state:":return"match task state";case"priority:":return"match task priority";case"content:":return"match task content";case"scheduled:":return"filter by scheduled date";case"deadline:":return"filter by deadline date";default:return""}}updateSelection(){this.containerEl.querySelectorAll(".search-suggest-item").forEach((e,t)=>{t-1===this.selectedIndex?e.addClass("is-selected"):e.removeClass("is-selected")})}handleKeyDown(s){if(!this.isShowing)return!1;switch(s.key){case"ArrowDown":return s.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.currentSuggestions.length-1),this.updateSelection(),!0;case"ArrowUp":return s.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.updateSelection(),!0;case"Enter":if(this.selectedIndex>=0&&this.selectedIndex<this.currentSuggestions.length)return s.preventDefault(),this.handleSelection(this.currentSuggestions[this.selectedIndex]),!0;break;case"Escape":return s.preventDefault(),this.hide(),!0;case"Tab":if(this.selectedIndex>=0&&this.selectedIndex<this.currentSuggestions.length)return s.preventDefault(),this.handleSelection(this.currentSuggestions[this.selectedIndex]),!0;break}return!1}handleSelection(s){var r;let e=this.inputEl,t=(r=e.selectionStart)!=null?r:0,n=e.value,i=s.endsWith(":")&&!s.includes(" "),o=t;for(;o>0&&!/\s/.test(n[o-1]);)o--;let a=n.substring(0,o)+s+n.substring(t);if(e.value=a,e.selectionStart=e.selectionEnd=o+s.length,i&&(this.isHandlingPrefixSelection=!0,this.suggestionDropdown&&this.suggestionDropdown.showPrefixDropdown(s,"")),setTimeout(()=>{let l=new Event("input",{bubbles:!0});e.dispatchEvent(l)},150),i||(this.isHandlingPrefixSelection=!1),e.focus(),i){let l=c=>{this.isHandlingPrefixSelection=!1,e.removeEventListener("keydown",l)};e.addEventListener("keydown",l)}}show(){if(this.isShowing)return;this.updatePosition(),this.containerEl.style.display="block",this.isShowing=!0;let s=this.containerEl.querySelector(".is-selected");s&&s.scrollIntoView({block:"nearest"})}hide(){this.isShowing&&(this.containerEl.style.display="none",this.isShowing=!1,this.selectedIndex=-1)}cleanup(){this.containerEl&&this.containerEl.parentNode&&this.containerEl.remove()}}});var he={};ie(he,{SearchSuggestionDropdown:()=>le});var le,pe=ne(()=>{re();le=class{constructor(s,e,t,n){this.currentSuggestions=[];this.selectedIndex=-1;this.currentPrefix=null;this.isShowing=!1;this.isHandlingPrefixSelection=!1;this.justSelected=!1;this.inputEl=s,this.vault=e,this.tasks=t,this.settings=n,this.containerEl=document.createElement("div"),this.containerEl.style.position="absolute",this.containerEl.style.zIndex="1000",this.containerEl.style.display="none",document.body.appendChild(this.containerEl),this.updateWidth(),this.setupEventListeners()}updateTasks(s){this.tasks=s}setupEventListeners(){document.addEventListener("click",s=>{let e=s.target;this.containerEl.contains(e)||e!==this.inputEl&&(this.isHandlingPrefixSelection||this.hide())}),this.inputEl.addEventListener("blur",()=>{requestAnimationFrame(()=>{this.isHandlingPrefixSelection||this.hide()})}),window.addEventListener("resize",()=>{this.updateWidth()}),window.addEventListener("scroll",()=>{this.updatePosition()},{passive:!0})}updateWidth(){let s=this.inputEl.getBoundingClientRect();this.containerEl.style.width=`${s.width}px`}updatePosition(){let s=this.inputEl.getBoundingClientRect(),e=window.scrollX+s.left,t=window.scrollY+s.bottom+2;this.containerEl.style.left=`${e}px`,this.containerEl.style.top=`${t}px`}async showPrefixDropdown(s,e=""){if(this.justSelected)return;this.currentPrefix=s;let t=s.endsWith(":")?s.slice(0,-1):s;if(t==="content"){this.hide();return}let n=[];switch(t){case"path":this.tasks&&this.tasks.length>0?n=L.getAllPathsFromTasks(this.tasks):n=await L.getAllPaths(this.vault);break;case"file":this.tasks&&this.tasks.length>0?n=L.getAllFilesFromTasks(this.tasks):n=await L.getAllFiles(this.vault);break;case"tag":n=L.getAllTags(this.tasks);break;case"state":n=L.getAllStates(this.settings);break;case"priority":n=L.getPriorityOptions();break;case"scheduled":let i=L.getDateSuggestions(),o=this.tasks&&this.tasks.length>0?L.getScheduledDateSuggestions(this.tasks):[];n=[...i,...o];break;case"deadline":let a=L.getDateSuggestions(),r=this.tasks&&this.tasks.length>0?L.getDeadlineDateSuggestions(this.tasks):[];n=[...a,...r];break;case"content":n=[];break;default:n=[]}e?this.currentSuggestions=L.filterSuggestions(e,n):this.currentSuggestions=n,await this.renderDropdown(),this.show()}async renderDropdown(){this.containerEl.innerHTML="";let e=this.containerEl.createEl("div",{cls:"suggestion-container mod-search-suggestion",attr:{style:"width: 300px;"}}).createEl("div",{cls:"suggestion"});if(this.currentSuggestions.length===0){e.createEl("div",{cls:"suggestion-item mod-complex search-suggest-item"}).createEl("div",{cls:"suggestion-content",text:"No suggestions found"});return}this.currentSuggestions.forEach((t,n)=>{let i=e.createEl("div",{cls:`suggestion-item mod-complex search-suggest-item ${n===this.selectedIndex?"is-selected":""}`}),a=i.createEl("div",{cls:"suggestion-content"}).createEl("div",{cls:"suggestion-title"}),r=t.endsWith("/")?t.slice(0,-1):t;a.createSpan({text:r}),i.addEventListener("mousedown",l=>{l.preventDefault(),this.handleSelection(t)}),i.addEventListener("mouseover",()=>{this.selectedIndex=n,this.updateSelection()})})}updateSelection(){this.containerEl.querySelectorAll(".search-suggest-item").forEach((e,t)=>{t===this.selectedIndex?e.addClass("is-selected"):e.removeClass("is-selected")})}handleKeyDown(s){if(!this.isShowing)return!1;switch(s.key){case"ArrowDown":return s.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.currentSuggestions.length-1),this.updateSelection(),!0;case"ArrowUp":return s.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.updateSelection(),!0;case"Enter":if(this.selectedIndex>=0&&this.selectedIndex<this.currentSuggestions.length)return s.preventDefault(),this.handleSelection(this.currentSuggestions[this.selectedIndex]),!0;break;case"Escape":return s.preventDefault(),this.hide(),!0;case"Tab":if(this.selectedIndex>=0&&this.selectedIndex<this.currentSuggestions.length)return s.preventDefault(),this.handleSelection(this.currentSuggestions[this.selectedIndex]),!0;break}return!1}handleSelection(s){var r;let e=this.inputEl,t=(r=e.selectionStart)!=null?r:0,n=e.value,o=n.substring(0,t).match(/(\w+):([^\s]*)$/);if(o){let l=o[0],c=o[1],d=t-l.length;if(c+":"===l.substring(0,c.length+1)){let g=d+c.length+1,u=t;for(;u<n.length&&!/\s/.test(n[u]);)u++;let p=s.includes(" ")?`"${s}"`:s,h=n.substring(0,g)+p+n.substring(u);e.value=h,e.selectionStart=e.selectionEnd=g+p.length}else{let g=d,u=t,p=n.substring(0,g)+s+n.substring(u);e.value=p,e.selectionStart=e.selectionEnd=g+s.length}}else{let l=t;for(;l>0&&!/\s/.test(n[l-1]);)l--;let c=n.substring(0,l)+s+n.substring(t);e.value=c,e.selectionStart=e.selectionEnd=l+s.length}this.hide(),this.justSelected=!0;let a=new Event("input",{bubbles:!0});e.dispatchEvent(a),this.isHandlingPrefixSelection=!1,e.focus(),setTimeout(()=>{this.justSelected=!1},100)}show(){if(this.isShowing)return;this.updatePosition(),this.containerEl.style.display="block",this.isShowing=!0;let s=this.containerEl.querySelector(".is-selected");s&&s.scrollIntoView({block:"nearest"})}hide(){this.isShowing&&(this.containerEl.style.display="none",this.isShowing=!1,this.selectedIndex=-1)}cleanup(){this.containerEl&&this.containerEl.parentNode&&this.containerEl.remove()}}});var nt={};ie(nt,{TASK_VIEW_ICON:()=>X,default:()=>Z});module.exports=be(nt);var V=require("obsidian");var b=require("obsidian");var Y=require("obsidian");var G=new Set(["TODO","LATER","WAIT","WAITING"]),B=new Set(["DOING","NOW","IN-PROGRESS"]),I=new Set(["DONE","CANCELED","CANCELLED"]),q=new Map([["TODO","DOING"],["DOING","DONE"],["DONE","TODO"],["LATER","NOW"],["NOW","DONE"],["WAIT","IN-PROGRESS"],["WAITING","IN-PROGRESS"],["IN-PROGRESS","DONE"],["CANCELED","TODO"],["CANCELLED","TODO"]]);var $=class f{constructor(s){this.app=s}static generateTaskLine(s,e,t=!0){let n=t&&s.priority?s.priority==="high"?"[#A]":s.priority==="med"?"[#B]":"[#C]":null,i=n?` ${n}`:"",o=s.text?` ${s.text}`:"",a=s.rawText.trim().match(/^(\s*[-*+]\s+)\[(\s|x)\]\s+(\w+)\s+/),r;if(a){let c=I.has(e)?"x":" ";r=`${s.indent}- [${c}] ${e}${i}${o}`}else r=`${s.indent}${s.listMarker||""}${e}${i}${o}`,s.tail&&(r+=s.tail);let l=I.has(e);return{newLine:r,completed:l}}async applyLineUpdate(s,e,t=!0){var a;let{newLine:n,completed:i}=f.generateTaskLine(s,e,t),o=this.app.vault.getAbstractFileByPath(s.path);if(o instanceof Y.TFile){let r=this.app.workspace.getActiveViewOfType(Y.MarkdownView),l=((a=r==null?void 0:r.file)==null?void 0:a.path)===s.path,c=r==null?void 0:r.editor;if(l&&c){let d=c.getLine(s.line);if(typeof d=="string"){let g={line:s.line,ch:0},u={line:s.line,ch:d.length};c.replaceRange(n,g,u)}}else await this.app.vault.process(o,d=>{let g=d.split(`
`);return s.line<g.length&&(g[s.line]=n),g.join(`
`)})}return{...s,rawText:n,state:e,completed:i}}async updateTaskState(s,e=null){let t=e==null?q.get(s.state)||"TODO":e;return await this.applyLineUpdate(s,t)}};var y=class{static formatDateForDisplay(s,e=!1){if(!s)return"";let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),o=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()-n.getTime(),a=Math.ceil(o/(1e3*60*60*24)),r=c=>c.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"}).replace(/AM|PM/i,g=>g.toLowerCase()),l=c=>c.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return a===0?e&&(s.getHours()!==0||s.getMinutes()!==0)?`Today ${r(s)}`:"Today":a===1?e&&(s.getHours()!==0||s.getMinutes()!==0)?`Tomorrow ${r(s)}`:"Tomorrow":a===-1?"Yesterday":a>0&&a<=7?`${a} days from now`:a<0?`${Math.abs(a)} days ago`:e&&(s.getHours()!==0||s.getMinutes()!==0)?`${l(s)} ${r(s)}`:l(s)}static parseDateValue(s,e=new Date){if(!s||s.trim()==="")return null;let t=s.trim().toLowerCase();switch(t){case"none":return"none";case"overdue":case"due":case"today":case"tomorrow":case"this week":case"next week":case"this month":case"next month":return t}let n=t.match(/^next\s+(\d+)\s+days$/);if(n)return`next ${n[1]} days`;let i=t.match(/^(\d{4}-\d{2}-\d{2})\.\.(\d{4}-\d{2}-\d{2})$/);if(i){let a=new Date(i[1]),r=new Date(i[2]);return r.setDate(r.getDate()+1),!isNaN(a.getTime())&&!isNaN(r.getTime())?{start:a,end:r}:null}if(t.match(/^\d{4}-\d{2}-\d{2}$/)){let a=t.split("-").map(Number),r=new Date(a[0],a[1]-1,a[2]);return isNaN(r.getTime())?null:{date:r,format:"full"}}if(t.match(/^\d{4}-\d{2}$/)){let a=t.split("-").map(Number),r=new Date(a[0],a[1]-1,1);return isNaN(r.getTime())?null:{date:r,format:"year-month"}}if(t.match(/^\d{4}$/)){let a=parseInt(t,10),r=new Date(a,0,1);return isNaN(r.getTime())?null:{date:r,format:"year"}}if(t.startsWith('"')&&t.endsWith('"')){let a=t.slice(1,-1),r=this.parseNaturalLanguageDate(a,e);return r?r.date:null}if(t.match(/^(next|this|last)\s+\w+$/)){let a=this.parseNaturalLanguageDate(t,e);return a?a.date:null}let o=t.match(/^in\s+(\d+)\s+days$/);if(o){let a=parseInt(o[1],10),r=new Date(e);return r.setDate(r.getDate()+a),r}return null}static parseNaturalLanguageDate(s,e=new Date){let t=s.toLowerCase();if(t==="next week"){let o=new Date(e),r=(8-e.getDay())%7;return o.setDate(o.getDate()+r),{date:o,format:"full"}}if(t==="this week"){let o=new Date(e),r=(e.getDay()+6)%7;return o.setDate(o.getDate()-r),{date:o,format:"full"}}let n=t.match(/^next\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/);if(n){let o=n[1],r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(o),l=new Date(e),c=l.getDay(),d=(r-c+7)%7;return d===0&&(d=7),l.setDate(l.getDate()+d),{date:l,format:"full"}}if(t==="end of month"||t==="end of the month"){let o=new Date(e);return o.setMonth(o.getMonth()+1,0),{date:o,format:"full"}}let i=t.match(/^in\s+(\d+)\s+days$/);if(i){let o=parseInt(i[1],10),a=new Date(e);return a.setDate(a.getDate()+o),{date:a,format:"full"}}return null}static isDateOverdue(s,e=new Date){if(!s)return!1;let t=new Date(e);t.setHours(0,0,0,0);let n=new Date(s);return n.setHours(0,0,0,0),n<t}static isDateDueToday(s,e=new Date){if(!s)return!1;let t=new Date(e);t.setHours(0,0,0,0);let n=new Date(s);return n.setHours(0,0,0,0),n.getTime()===t.getTime()}static isDateDueTomorrow(s,e=new Date){if(!s)return!1;let t=new Date(e);t.setDate(t.getDate()+1),t.setHours(0,0,0,0);let n=new Date(s);return n.setHours(0,0,0,0),n.getTime()===t.getTime()}static isDateInCurrentWeek(s,e=new Date,t="Monday"){if(!s)return!1;let n=new Date(s),i=new Date(e),o=i.getDay(),a;if(t==="Monday"){let l=(o+6)%7;a=new Date(i),a.setDate(a.getDate()-l)}else{let l=o;a=new Date(i),a.setDate(a.getDate()-l)}a.setHours(0,0,0,0);let r=new Date(a);return r.setDate(r.getDate()+6),r.setHours(23,59,59,999),n.setHours(0,0,0,0),n>=a&&n<=r}static isDateInNextWeek(s,e=new Date,t="Monday"){if(!s)return!1;let n=new Date(s),i=new Date(e),o=i.getDay(),a;if(t==="Monday"){let l=o===1?7:(8-o)%7;a=new Date(i),a.setDate(a.getDate()+l)}else{let l=o===0?7:(7-o)%7;a=new Date(i),a.setDate(a.getDate()+l)}a.setHours(0,0,0,0);let r=new Date(a);return r.setDate(r.getDate()+6),r.setHours(23,59,59,999),n.setHours(0,0,0,0),n>=a&&n<=r}static isDateInCurrentMonth(s,e=new Date){if(!s)return!1;let t=new Date(s),n=new Date(e);return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()}static isDateInNextMonth(s,e=new Date){if(!s)return!1;let t=new Date(s),n=new Date(e),i=n.getMonth()+1,o=n.getFullYear()+(i>11?1:0),a=i>11?0:i;return t.getFullYear()===o&&t.getMonth()===a}static isDateInNextNDays(s,e,t=new Date){if(!s)return!1;let n=new Date(s),i=new Date(t),o=new Date(i);return n.setHours(0,0,0,0),i.setHours(0,0,0,0),o.setDate(o.getDate()+e),o.setHours(23,59,59,999),n>=i&&n<=o}static isDateInRange(s,e,t){if(!s)return!1;let n=new Date(s);return n.setHours(0,0,0,0),n>=e&&n<t}static compareDates(s,e){if(!s||!e)return!1;let t=s.getFullYear(),n=s.getMonth(),i=s.getDate(),o=e.getFullYear(),a=e.getMonth(),r=e.getDate();return t===o&&n===a&&i===r}};var x=class extends Error{constructor(e,t){super(e);this.position=t;this.name="SearchError"}};var N=class{static tokenize(s){let e=[],t=0;for(;t<s.length;){if(/\s/.test(s[t])){t++;continue}let n=!1;for(let i of this.PATTERNS){i.regex.lastIndex=t;let o=i.regex.exec(s);if(o&&o.index===t){let a=this.processTokenValue(o[0],i.type),r=i.type;if(r==="word"&&e.length>0&&e[e.length-1].type==="prefix"&&(r="prefix_value"),r==="not"&&e.length>0&&e[e.length-1].type==="prefix_value"){let l=e[e.length-1].position+e[e.length-1].original.length;if(!(t>l)){let g=i.regex.lastIndex,u=/[^\s"()\-]+/y;u.lastIndex=g;let p=u.exec(s);if(p&&p.index===g){let h=e[e.length-1];e[e.length-1]={type:"prefix_value",value:h.value+"-"+p[0],original:h.original+"-"+p[0],position:h.position},t=u.lastIndex,n=!0;break}}}e.push({type:r,value:a,original:o[0],position:t}),t=i.regex.lastIndex,n=!0;break}}n||t++}return e}static processTokenValue(s,e){switch(e){case"phrase":return s.slice(1,-1).replace(/\\"/g,'"');case"prefix":return s.slice(0,-1);case"prefix_value":return s.startsWith('"')&&s.endsWith('"')?s.slice(1,-1).replace(/\\"/g,'"'):s;case"or":case"and":case"range":return s.toLowerCase();case"word":case"not":case"lparen":case"rparen":return s;default:return s}}static getBindingPower(s){switch(s){case"not":return 100;case"and":return 80;case"or":return 60;case"range":return 50;case"prefix":return 50;case"prefix_value":return 50;case"word":return 50;case"phrase":return 50;default:return 50}}};N.PATTERNS=[{type:"phrase",regex:/"(?:\\.|[^"\\])*"/y},{type:"or",regex:/\bOR\b/y},{type:"and",regex:/\bAND\b/y},{type:"not",regex:/-/y},{type:"range",regex:/\.\./y},{type:"lparen",regex:/\(/y},{type:"rparen",regex:/\)/y},{type:"prefix",regex:/\b(path|file|tag|state|priority|content|scheduled|deadline):/y},{type:"word",regex:/[^\s"()\-]+/y}];var W=class{static parse(s){let e=N.tokenize(s);return this.parseTokens(e)}static parseTokens(s){return new ae(s).parseExpression(0)}static validate(s){try{return this.parse(s),!0}catch(e){return!1}}},ae=class{constructor(s){this.position=0;this.tokens=s}parseExpression(s){let e=this.parsePrefix();for(;this.position<this.tokens.length;){let t=this.tokens[this.position];if(t.type==="rparen"||N.getBindingPower(t.type)<=s)break;if(t.type==="not"){this.position++;let i=this.parseExpression(N.getBindingPower("not")-1);e={type:"and",children:[e,{type:"not",children:[i],position:t.position}],position:t.position};continue}if(t.type==="prefix"){let i=this.parsePrefixFilter();e={type:"and",children:[e,i],position:t.position};continue}if(this.position++,t.type==="word"||t.type==="phrase"){let i=this.createTermNode(t);e={type:"and",children:[e,i],position:t.position}}else e=this.parseInfix(e,t)}return e}parsePrefix(){if(this.position>=this.tokens.length)throw new x("Unexpected end of expression",this.position);let s=this.tokens[this.position];switch(s.type){case"not":return this.position++,{type:"not",children:[this.parseExpression(N.getBindingPower("not")-1)],position:s.position};case"lparen":this.position++;let t=this.parseExpression(0);if(this.position>=this.tokens.length||this.tokens[this.position].type!=="rparen")throw new x("Expected closing parenthesis",this.position);return this.position++,t;case"prefix":return this.parsePrefixFilter();case"word":case"phrase":return this.position++,this.createTermNode(s);default:throw new x(`Unexpected token: ${s.original}`,s.position)}}parsePrefixFilter(){if(this.position>=this.tokens.length)throw new x("Unexpected end of expression after prefix",this.position);let s=this.tokens[this.position];if(s.type!=="prefix")throw new x(`Expected prefix token, got ${s.type}`,s.position);if(this.position++,this.position>=this.tokens.length)throw new x("Expected value after prefix",s.position);let e=this.tokens[this.position];if(e.type==="prefix_value"||e.type==="word"||e.type==="phrase"){let t=s.value,n=e.value;return this.position++,{type:"prefix_filter",field:t,value:n,position:s.position}}else throw new x(`Expected prefix value, got ${e.type}`,e.position)}parseInfix(s,e){switch(e.type){case"or":case"and":{let t=this.parseExpression(N.getBindingPower(e.type)-1);return{type:e.type,children:[s,t],position:e.position}}case"range":if(s.type==="prefix_filter"&&s.field&&(s.field==="scheduled"||s.field==="deadline")){let t=this.tokens[this.position];if(!t||t.type!=="prefix_value"&&t.type!=="word"&&t.type!=="phrase")throw new x("Expected date value after range operator",e.position);return this.position++,{type:"range_filter",field:s.field,start:s.value,end:t.value,position:e.position}}else throw new x("Range operator can only be used with scheduled: or deadline: prefixes",e.position);default:throw new x(`Unexpected infix operator: ${e.original}`,e.position)}}createTermNode(s){switch(s.type){case"word":return{type:"term",value:s.value,position:s.position};case"phrase":return{type:"phrase",value:s.value,position:s.position};case"prefix_value":return{type:"term",value:s.value,position:s.position};default:throw new x(`Cannot create term from token type: ${s.type}`,s.position)}}static postProcessAST(s){return(s.type==="and"||s.type==="or")&&s.children&&(s.children=s.children.map(e=>this.postProcessAST(e))),s}};var j=class{static evaluate(s,e,t,n){switch(s.type){case"term":return this.evaluateTerm(s.value,e,t);case"phrase":return this.evaluatePhrase(s.value,e,t);case"prefix_filter":return this.evaluatePrefixFilter(s,e,t,n);case"range_filter":return this.evaluateRangeFilter(s,e,t);case"and":return this.evaluateAnd(s.children,e,t);case"or":return this.evaluateOr(s.children,e,t);case"not":return this.evaluateNot(s.children[0],e,t);default:return!1}}static evaluateTerm(s,e,t){let n=t?s:s.toLowerCase();return this.getSearchableFields(e).some(o=>(t?o:o.toLowerCase()).includes(n))}static evaluatePhrase(s,e,t){let n=this.escapeRegex(s),i=t?"g":"gi",o=new RegExp(`\\b${n}\\b`,i);return this.getSearchableFields(e).some(r=>o.test(r))}static evaluateAnd(s,e,t){for(let n of s)if(!this.evaluate(n,e,t))return!1;return!0}static evaluateOr(s,e,t){for(let n of s)if(this.evaluate(n,e,t))return!0;return!1}static evaluateNot(s,e,t){return!this.evaluate(s,e,t)}static evaluatePrefixFilter(s,e,t,n){let i=s.field,o=s.value;if(!i||!o)return!1;switch(i){case"path":return this.evaluatePathFilter(o,e,t);case"file":return this.evaluateFileFilter(o,e,t);case"tag":return this.evaluateTagFilter(o,e,t);case"state":return this.evaluateStateFilter(o,e,t);case"priority":return this.evaluatePriorityFilter(o,e,t);case"content":return this.evaluateContentFilter(o,e,t);case"scheduled":return this.evaluateScheduledFilter(o,e,t,n);case"deadline":return this.evaluateDeadlineFilter(o,e,t,n);default:return!1}}static evaluatePathFilter(s,e,t){if(!e.path)return!1;let n=t?s:s.toLowerCase(),i=t?e.path:e.path.toLowerCase(),o=n+"/";if(i===n||i.startsWith(o))return!0;let a=i.split("/");for(let r=0;r<a.length-1;r++)if(a[r]===n)return!0;return!1}static evaluateFileFilter(s,e,t){if(!e.path)return!1;let n=e.path.lastIndexOf("/"),i=n>=0?e.path.slice(n+1):e.path,o=t?s:s.toLowerCase();return(t?i:i.toLowerCase()).includes(o)}static evaluateTagFilter(s,e,t){if(!e.rawText)return!1;let n=t?s:s.toLowerCase(),i=t?e.rawText:e.rawText.toLowerCase(),o=/#([\w\-]+)/g;return(i.match(o)||[]).some(r=>(t?r:r.toLowerCase()).includes(n))}static evaluateStateFilter(s,e,t){let n=t?s:s.toLowerCase();return(t?e.state:e.state.toLowerCase())===n}static evaluatePriorityFilter(s,e,t){let n=s.toLowerCase();if(n==="high"||n==="a")n="high";else if(n==="medium"||n==="b")n="med";else if(n==="low"||n==="c")n="low";else if(n==="none")return!e.priority;return(e.priority?e.priority.toLowerCase():null)===n}static evaluateContentFilter(s,e,t){if(!e.text)return!1;let n=t?s:s.toLowerCase();return(t?e.text:e.text.toLowerCase()).includes(n)}static getSearchableFields(s){let e=[];if(s.rawText&&e.push(s.rawText),s.text&&e.push(s.text),s.path){e.push(s.path);let t=s.path.lastIndexOf("/"),n=t>=0?s.path.slice(t+1):s.path;e.push(n)}return e}static escapeRegex(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static evaluateScheduledFilter(s,e,t,n){let i=y.parseDateValue(s);if(i==null)return!1;if(i==="none")return!e.scheduledDate;if(!e.scheduledDate)return!1;if(typeof i=="string")return this.evaluateDateExpression(i,e.scheduledDate,n);if(typeof i=="object"&&i!==null&&"start"in i&&"end"in i)return y.isDateInRange(e.scheduledDate,i.start,i.end);if(typeof i=="object"&&i!==null&&"date"in i&&"format"in i){let o=i.date,a=i.format,r=e.scheduledDate;switch(a){case"year":return o.getUTCFullYear()===r.getUTCFullYear();case"year-month":return o.getUTCFullYear()===r.getUTCFullYear()&&o.getUTCMonth()===r.getUTCMonth();case"full":return y.compareDates(r,o);default:return!1}}return i instanceof Date?y.compareDates(e.scheduledDate,i):!1}static evaluateDeadlineFilter(s,e,t,n){let i=y.parseDateValue(s);if(i==null)return!1;if(i==="none")return!e.deadlineDate;if(!e.deadlineDate)return!1;if(typeof i=="string")return this.evaluateDateExpression(i,e.deadlineDate,n);if(typeof i=="object"&&i!==null&&"start"in i&&"end"in i)return y.isDateInRange(e.deadlineDate,i.start,i.end);if(typeof i=="object"&&i!==null&&"date"in i&&"format"in i){let o=i.date,a=i.format,r=e.deadlineDate;switch(a){case"year":return o.getUTCFullYear()===r.getUTCFullYear();case"year-month":return o.getUTCFullYear()===r.getUTCFullYear()&&o.getUTCMonth()===r.getUTCMonth();case"full":return y.compareDates(r,o);default:return!1}}return i instanceof Date?y.compareDates(e.deadlineDate,i):!1}static evaluateDateExpression(s,e,t){var o;let n=new Date,i=(o=t==null?void 0:t.weekStartsOn)!=null?o:"Monday";switch(s){case"overdue":return y.isDateOverdue(e,n);case"due":return y.isDateDueToday(e,n)||y.isDateOverdue(e,n);case"today":return y.isDateDueToday(e,n);case"tomorrow":return y.isDateDueTomorrow(e,n);case"this week":return y.isDateInCurrentWeek(e,n,i);case"next week":return y.isDateInNextWeek(e,n,i);case"this month":return y.isDateInCurrentMonth(e,n);case"next month":return y.isDateInNextMonth(e,n);default:let a=s.match(/^next\s+(\d+)\s+days$/);if(a){let r=parseInt(a[1],10);return y.isDateInNextNDays(e,r,n)}return!1}}static evaluateRangeFilter(s,e,t){let n=s.field,i=s.start,o=s.end;if(!n||!i||!o)return!1;let a=y.parseDateValue(i),r=y.parseDateValue(o);if(a===null||r===null)return!1;let l=n==="scheduled"?e.scheduledDate:e.deadlineDate;if(!l)return!1;let c,d;if(typeof a=="object"&&a!==null&&"start"in a&&"end"in a)c=a.start;else if(typeof a=="object"&&a!==null&&"date"in a)c=a.date;else if(a instanceof Date)c=a;else return!1;if(typeof r=="object"&&r!==null&&"start"in r&&"end"in r)d=r.end;else if(typeof r=="object"&&r!==null&&"date"in r)d=r.date;else if(r instanceof Date)d=r;else return!1;return d=new Date(d),d.setDate(d.getDate()+1),y.isDateInRange(l,c,d)}};var H=class{static parse(s){return W.parse(s)}static evaluate(s,e,t=!1,n){try{let i=this.parse(s);return j.evaluate(i,e,t,n)}catch(i){if(i instanceof x)return!1;throw i}}static validate(s){return W.validate(s)}static getError(s){try{return this.parse(s),null}catch(e){return e instanceof x?e.message:"Invalid search query"}}};var U=class U extends b.ItemView{constructor(e,t,n,i){super(e);this.settings=i;this.searchInputEl=null;this.isCaseSensitive=!1;this.searchError=null;this.optionsDropdown=null;this.suggestionDropdown=null;this.tasks=t,this.editor=new $(this.app),this.defaultViewMode=n}getViewMode(){let e=this.contentEl.getAttr("data-view-mode");if(typeof e=="string"){if(e==="default")return"showAll";if(e==="sortCompletedLast")return"sortCompletedLast";if(e==="hideCompleted")return"hideCompleted";if(e==="showAll"||e==="sortCompletedLast"||e==="hideCompleted")return e}let t=this.defaultViewMode;return t==="default"?"showAll":t==="sortCompletedLast"?"sortCompletedLast":t==="hideCompleted"?"hideCompleted":t==="showAll"||t==="sortCompletedLast"||t==="hideCompleted"?t:"showAll"}setViewMode(e){this.contentEl.setAttr("data-view-mode",e)}getSortMethod(){let e=this.contentEl.getAttr("data-sort-method");return typeof e=="string"&&(e==="default"||e==="sortByScheduled"||e==="sortByDeadline"||e==="sortByPriority")?e:this.defaultSortMethod==="default"||this.defaultSortMethod==="sortByScheduled"||this.defaultSortMethod==="sortByDeadline"||this.defaultSortMethod==="sortByPriority"?this.defaultSortMethod:"default"}setSortMethod(e){this.contentEl.setAttr("data-sort-method",e)}transformForView(e,t){let n=e.slice();if(t==="hideCompleted")return n=n.filter(i=>!i.completed),this.applySortToTasks(n),n;if(t==="sortCompletedLast"){let i=[],o=[];for(let a of n)(a.completed?o:i).push(a);this.applySortToTasks(i),this.applySortToTasks(o),n=i.concat(o)}else this.applySortToTasks(n);return n}applySortToTasks(e){let t=this.getSortMethod();t==="default"?e.sort((n,i)=>{let o=n.path.localeCompare(i.path);return o!==0?o:n.line-i.line}):t==="sortByScheduled"?e.sort((n,i)=>!n.scheduledDate&&!i.scheduledDate?0:n.scheduledDate?i.scheduledDate?n.scheduledDate.getTime()-i.scheduledDate.getTime():-1:1):t==="sortByDeadline"?e.sort((n,i)=>!n.deadlineDate&&!i.deadlineDate?0:n.deadlineDate?i.deadlineDate?n.deadlineDate.getTime()-i.deadlineDate.getTime():-1:1):t==="sortByPriority"&&e.sort((n,i)=>{let o={high:3,med:2,low:1,null:0},a=n.priority?o[n.priority]:0,r=i.priority?o[i.priority]:0;if(a!==r)return r-a;let l=n.path.localeCompare(i.path);return l!==0?l:n.line-i.line})}getSearchQuery(){let e=this.contentEl.getAttr("data-search");return typeof e=="string"?e:""}setSearchQuery(e){this.contentEl.setAttr("data-search",e)}buildToolbar(e){let t=e.createEl("div",{cls:"todo-toolbar"}),n=t.createEl("div",{cls:"search-row"}),i=`todoseq-search-${Math.random().toString(36).slice(2,8)}`,o=n.createEl("label",{attr:{for:i}});o.setText("Search"),o.addClass("sr-only");let a=n.createEl("div",{cls:"search-input-container global-search-input-container"}),r=a.createEl("input",{attr:{id:i,type:"search",placeholder:"Search tasks\u2026","aria-label":"Search tasks"}});a.createEl("div",{cls:"search-input-clear-button",attr:{"aria-label":"Clear search"}}).addEventListener("click",()=>{r.value="",this.setSearchQuery(""),this.refreshVisibleList()});let c=a.createEl("div",{cls:"input-right-decorator clickable-icon",attr:{"aria-label":"Match case"}});if((0,b.setIcon)(c,"uppercase-lowercase-a"),c.addEventListener("click",()=>{this.isCaseSensitive=!this.isCaseSensitive,c.toggleClass("is-active",this.isCaseSensitive),this.refreshVisibleList()}),!(r instanceof HTMLInputElement))throw new Error("Failed to create search input element");r.value=this.getSearchQuery(),r.addEventListener("input",()=>{this.setSearchQuery(r.value),this.refreshVisibleList()});let d=n.createEl("div",{cls:"clickable-icon"});d.setAttr("title","Task View settings"),d.setAttr("aria-label","Task View settings"),d.setAttr("aria-expanded",String(!1)),(0,b.setIcon)(d,"lucide-sliders-horizontal");let g=t.createEl("div",{cls:"search-params"});g.style.display="none";let u=g.createEl("div",{cls:"setting-item"}),h=u.createEl("div",{cls:"setting-item-info"}).createEl("div",{cls:"setting-item-name",text:"Show completed tasks:",attr:{for:"completed-tasks-dropdown"}}),m=u.createEl("div",{cls:"setting-item-control"}).createEl("select",{cls:"mod-small ",attr:{id:"completed-tasks-dropdown","aria-label":"Show completed tasks"}}),C=[{value:"showAll",label:"Show"},{value:"sortCompletedLast",label:"Sort to end"},{value:"hideCompleted",label:"Hide"}];for(let S of C){let A=m.createEl("option",{attr:{value:S.value},text:S.label})}let T=this.getViewMode();m.value=T,d.addEventListener("click",()=>{let S=g.style.display!=="none";g.style.display=S?"none":"block",d.setAttr("aria-expanded",String(!S)),S?d.removeClass("is-active"):d.addClass("is-active")}),m.addEventListener("change",()=>{let S=m.value;this.setViewMode(S);let A=new CustomEvent("todoseq:view-mode-change",{detail:{mode:S}});window.dispatchEvent(A),this.refreshVisibleList()});let E=t.createEl("div",{cls:"search-results-info"});E.createEl("div",{cls:"search-results-result-count"}).createEl("span").setText("0 of 0 tasks");let D=E.createEl("select",{cls:"dropdown",attr:{"aria-label":"Sort tasks by","data-sort-mode":"default"}}),F=[{value:"default",label:"Default (file path)"},{value:"sortByScheduled",label:"Scheduled date"},{value:"sortByDeadline",label:"Deadline date"},{value:"sortByPriority",label:"Priority"}];for(let S of F)D.createEl("option",{attr:{value:S.value}}).setText(S.label);let _=this.getSortMethod();D.value=_,D.addEventListener("change",()=>{let S=D.value,A="default";S==="sortByScheduled"?A="sortByScheduled":S==="sortByDeadline"?A="sortByDeadline":S==="sortByPriority"&&(A="sortByPriority"),this.setSortMethod(A),D.value=A;let ee=new CustomEvent("todoseq:sort-method-change",{detail:{sortMethod:A}});window.dispatchEvent(ee),this.refreshVisibleList()}),this.searchInputEl=r}setupSearchSuggestions(){let e=this.searchInputEl;e&&Promise.all([Promise.resolve().then(()=>(ue(),de)),Promise.resolve().then(()=>(pe(),he))]).then(([t,n])=>{this.suggestionDropdown=new n.SearchSuggestionDropdown(e,this.app.vault,this.tasks,this.settings),this.optionsDropdown=new t.SearchOptionsDropdown(e,this.app.vault,this.tasks,this.settings,this.suggestionDropdown),e.addEventListener("input",()=>{this.handleSearchInputForSuggestions()}),e.addEventListener("focus",()=>{this.handleSearchFocus()}),e.addEventListener("keydown",i=>{(this.optionsDropdown&&this.optionsDropdown.handleKeyDown(i)||this.suggestionDropdown&&this.suggestionDropdown.handleKeyDown(i))&&(i.preventDefault(),i.stopPropagation())})}).catch(t=>{console.error("Failed to load search suggestion dropdowns:",t)})}handleSearchInputForSuggestions(){var o;if(!this.searchInputEl||!this.optionsDropdown||!this.suggestionDropdown)return;let e=this.searchInputEl.value,t=(o=this.searchInputEl.selectionStart)!=null?o:0;if(e.length===0){this.optionsDropdown.showOptionsDropdown(e),this.suggestionDropdown.hide();return}let i=e.substring(0,t).match(/(\w+)(:([^\s]*))?$/);if(i){let a=i[1],r=i[2]!==void 0,l=i[3]||"",c=["path","file","tag","state","priority","content","scheduled","deadline"];if(c.includes(a)||c.some(d=>d.startsWith(a))){if(r){let d=a+":";this.suggestionDropdown.showPrefixDropdown(d,l),this.optionsDropdown.hide()}else this.optionsDropdown.showOptionsDropdown(a),this.suggestionDropdown.hide();return}}if(t===e.length&&e.endsWith(" ")){this.optionsDropdown.showOptionsDropdown(),this.suggestionDropdown.hide();return}!this.optionsDropdown.isHandlingPrefixSelection&&!this.suggestionDropdown.isHandlingPrefixSelection&&(this.optionsDropdown.hide(),this.suggestionDropdown.hide())}handleSearchFocus(){if(!this.searchInputEl||!this.optionsDropdown||!this.suggestionDropdown)return;this.searchInputEl.value.length===0&&(this.optionsDropdown.showOptionsDropdown(),this.suggestionDropdown.hide())}async updateTaskState(e,t){let n=await this.editor.updateTaskState(e,t);e.rawText=n.rawText,typeof n.state=="string"&&(e.state=n.state),e.completed=!!n.completed}updateTasks(e){this.tasks=e,this.optionsDropdown&&this.optionsDropdown.updateTasks(e),this.suggestionDropdown&&this.suggestionDropdown.updateTasks(e)}getViewType(){return U.viewType}getKeywordSets(){var r,l,c;let e=[...Array.from(G),...Array.from(B)],t=Array.from(I),i=(l=(r=this.app.plugins)==null?void 0:r.plugins)==null?void 0:l.todoseq,o=(c=i==null?void 0:i.settings)==null?void 0:c.additionalTaskKeywords,a=Array.isArray(o)?o.filter(d=>typeof d=="string"&&d.length>0):[];return{pendingActive:e,completed:t,additional:a}}getSelectableStatesForMenu(e){let{pendingActive:t,completed:n,additional:i}=this.getKeywordSets(),o=c=>Array.from(new Set(c)),a=o([...t,...i]),r=o(n);return[{group:"Not completed",states:a.filter(c=>c&&c!==e)},{group:"Completed",states:r.filter(c=>c&&c!==e)}].filter(c=>c.states.length>0)}openStateMenuAtMouseEvent(e,t){t.preventDefault(),t.stopPropagation();let n=new b.Menu,i=this.getSelectableStatesForMenu(e.state);for(let a of i){n.addItem(r=>{r.setTitle(a.group),r.setDisabled(!0)});for(let r of a.states)n.addItem(l=>{l.setTitle(r),l.onClick(async()=>{await this.updateTaskState(e,r),this.refreshTaskElement(e)})});n.addSeparator()}let o=n.showAtMouseEvent;typeof o=="function"?o.call(n,t):n.showAtPosition({x:t.clientX,y:t.clientY})}openStateMenuAtPosition(e,t){let n=new b.Menu,i=this.getSelectableStatesForMenu(e.state);for(let o of i){n.addItem(a=>{a.setTitle(o.group),a.setDisabled(!0)});for(let a of o.states)n.addItem(r=>{r.setTitle(a),r.onClick(async()=>{await this.updateTaskState(e,a),this.refreshTaskElement(e)})});n.addSeparator()}n.showAtPosition({x:t.x,y:t.y})}getDisplayText(){return"TODOseq"}getIcon(){return X}buildCheckbox(e,t){let n=t.createEl("input",{type:"checkbox",cls:"todo-checkbox"});return B.has(e.state)&&n.addClass("todo-checkbox-active"),n.checked=e.completed,n.addEventListener("change",async()=>{let i=n.checked?"DONE":"TODO";await this.updateTaskState(e,i),this.getViewMode()!=="showAll"?this.refreshVisibleList():this.refreshTaskElement(e)}),n}buildKeyword(e,t){let n=t.createEl("span",{cls:"todo-keyword"});n.setText(e.state),n.setAttr("role","button"),n.setAttr("tabindex","0"),n.setAttr("aria-checked",String(e.completed));let i=async u=>{var p;u.stopPropagation(),await this.updateTaskState(e,(p=q.get(e.state))!=null?p:"DONE"),this.refreshTaskElement(e)};n.addEventListener("click",u=>i(u)),n.addEventListener("keydown",u=>{let p=u.key;if((p==="Enter"||p===" ")&&(u.preventDefault(),u.stopPropagation(),i(u)),p==="F10"&&u.shiftKey){u.preventDefault(),u.stopPropagation();let h=n.getBoundingClientRect();this.openStateMenuAtPosition(e,{x:h.left,y:h.bottom})}if(p==="ContextMenu"){u.preventDefault(),u.stopPropagation();let h=n.getBoundingClientRect();this.openStateMenuAtPosition(e,{x:h.left,y:h.bottom})}});let o=!1,a=0,r=350,l=u=>{let p=Date.now();if(p-a<r){u.preventDefault(),u.stopPropagation();return}a=p,this.openStateMenuAtMouseEvent(e,u)},c=(u,p)=>{let h=Date.now();h-a<r||(a=h,this.openStateMenuAtPosition(e,{x:u,y:p}))};n.addEventListener("contextmenu",u=>{if(o){u.preventDefault(),u.stopPropagation();return}l(u)});let d=null;n.addEventListener("touchstart",u=>{if(u.touches.length!==1)return;let p=u.touches[0];o=!0,d=window.setTimeout(()=>{let h=p.clientX,k=p.clientY;c(h,k)},450)},{passive:!0});let g=()=>{d&&(window.clearTimeout(d),d=null),window.setTimeout(()=>{o=!1},250)};return n.addEventListener("touchend",g,{passive:!0}),n.addEventListener("touchcancel",g,{passive:!0}),n.addEventListener("click",u=>{if(Date.now()-a<r){u.preventDefault(),u.stopPropagation();return}},!0),n}buildText(e,t){let n=t.createEl("span",{cls:"todo-text"});if(this.buildKeyword(e,n),e.priority){let o=e.priority,a=n.createEl("span",{cls:["priority-badge",`priority-${o}`]});a.setText(o==="high"?"A":o==="med"?"B":"C"),a.setAttribute("aria-label",`Priority ${o}`),a.setAttribute("title",`Priority ${o}`)}let i=e.text;return i&&(n.appendText(" "),this.renderTaskTextWithLinks(i,n)),n.toggleClass("completed",e.completed),n}buildTaskListItem(e){let t=createEl("li",{cls:"todo-item"});t.setAttribute("data-path",e.path),t.setAttribute("data-line",String(e.line));let n=this.buildCheckbox(e,t);this.buildText(e,t),(e.scheduledDate||e.deadlineDate)&&!e.completed&&this.buildDateDisplay(e,t);let i=t.createEl("div",{cls:"todo-file-info"}),o=e.path.lastIndexOf("/"),a=o>=0?e.path.slice(o+1):e.path;return i.setText(`${a}:${e.line+1}`),i.setAttribute("title",e.path),t.addEventListener("click",r=>{let l=r.target;l!==n&&l instanceof HTMLElement&&!l.hasClass("todo-keyword")&&this.openTaskLocation(r,e)}),t}refreshTaskElement(e){let n=this.contentEl.querySelector("ul.todo-list");if(!n)return;let i=`li.todo-item[data-path="${CSS.escape(e.path)}"][data-line="${e.line}"]`,o=n.querySelector(i),a=this.buildTaskListItem(e);o&&o.parentElement===n?n.replaceChild(a,o):n.appendChild(a)}refreshVisibleList(){var d,g,u;let e=this.contentEl,t=e.querySelector(".sort-dropdown select");if(t){let p=this.getSortMethod();t.value=p}let n=e.querySelector("ul.todo-list");n||(n=e.createEl("ul",{cls:"todo-list"})),n.empty();let i=this.getViewMode(),o=(d=this.tasks)!=null?d:[],a=this.transformForView(o,i),r=this.getSearchQuery().trim();if(r.length>0)try{a=a.filter(p=>H.evaluate(r,p,this.isCaseSensitive,this.settings)),this.searchError=null}catch(p){let h=this.isCaseSensitive?r:r.toLowerCase(),k=this.isCaseSensitive?m=>m:m=>m.toLowerCase();a=a.filter(m=>{let C=m.path.slice(m.path.lastIndexOf("/")+1);return m.rawText&&k(m.rawText).includes(h)||m.text&&k(m.text).includes(h)||m.path&&k(m.path).includes(h)||C&&k(C).includes(h)}),this.searchError=H.getError(r)||"Invalid search query"}else this.searchError=null;let l=e.querySelector(".search-results-result-count");l&&l.setText(`${a.length} of ${o.length} task`+(o.length===1?"":"s"));let c=e.querySelector(".search-error-container");if(this.searchError?c||e.createEl("div",{cls:"search-error-container"}).createEl("div",{cls:"search-error"}).setText(this.searchError):c&&c.detach(),a.length===0){let p=e.querySelector(".todo-empty");p&&((g=p.detach)==null||g.call(p));let h=o.length>0,k=o.some(w=>!w.completed),m=i==="hideCompleted",C=e.createEl("div",{cls:"todo-empty"}),T=C.createEl("div",{cls:"todo-empty-title"}),E=C.createEl("div",{cls:"todo-empty-subtitle"});h?m&&!k?(T.setText("All tasks are completed"),E.setText("You are hiding completed tasks. Switch view mode or add new tasks to see more.")):(T.setText("No matching tasks"),E.setText("Try clearing the search or switching view modes.")):(T.setText("No tasks found"),E.setText('Create tasks in your notes using "TODO Your task". They will appear here automatically.'));return}else{let p=e.querySelector(".todo-empty");p&&((u=p.detach)==null||u.call(p))}for(let p of a){let h=this.buildTaskListItem(p);n.appendChild(h)}}async onOpen(){var i;let e=this.contentEl;e.empty(),e.addClass("todo-view"),this.buildToolbar(e),this.setupSearchSuggestions(),this.refreshVisibleList();let t=(i=this.searchInputEl)!=null?i:null,n=o=>{let a=document.activeElement,r=!!a&&(a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable===!0);o.key==="/"&&!o.metaKey&&!o.ctrlKey&&!o.altKey&&!r&&t&&(o.preventDefault(),t.focus(),t.select()),o.key==="Escape"&&a===t&&t&&(o.preventDefault(),t.value="",this.setSearchQuery(""),this.refreshVisibleList(),queueMicrotask(()=>t.blur()))};this._searchKeyHandler=n,window.addEventListener("keydown",n)}formatDateForDisplay(e,t=!1){return e?y.formatDateForDisplay(e,t):""}getDateStatusClasses(e,t=!1){if(!e)return[];let n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-i.getTime(),r=Math.ceil(a/(1e3*60*60*24)),l=["todo-date"];return l.push("todo-date"),r<0?l.push("todo-date-overdue"):r===0?l.push("todo-date-today"):r<=3&&l.push("todo-date-soon"),l}buildDateDisplay(e,t){let n=t.createEl("div",{cls:"todo-date-container"});if(e.scheduledDate){let i=n.createEl("div",{cls:this.getDateStatusClasses(e.scheduledDate,!1)});i.createEl("span",{cls:"date-label"}).setText("Scheduled: "),i.createEl("span",{cls:"date-value"}).setText(this.formatDateForDisplay(e.scheduledDate,!0))}if(e.deadlineDate){let i=n.createEl("div",{cls:this.getDateStatusClasses(e.deadlineDate,!0)});i.createEl("span",{cls:"date-label"}).setText("Deadline: "),i.createEl("span",{cls:"date-value"}).setText(this.formatDateForDisplay(e.deadlineDate,!0))}}stripMarkdown(e){if(!e)return"";let t=e;return t=new DOMParser().parseFromString(t,"text/html").body.textContent||"",t=t.replace(/!\[([^\]]*)\]\([^)]*\)/g,"$1"),t=t.replace(/`([^`]+)`/g,"$1"),t=t.replace(/^\s{0,3}#{1,6}\s+/gm,""),t=t.replace(/(\*\*|__)(.*?)\1/g,"$2"),t=t.replace(/(\*|_)(.*?)\1/g,"$2"),t=t.replace(/~~(.*?)~~/g,"$1"),t=t.replace(/==(.*?)==/g,"$1"),t=t.replace(/\$\$(.*?)\$\$/g,"$1"),t=t.replace(/\r/g,""),t=t.replace(/[ \t]+\n/g,`
`),t=t.replace(/\n{3,}/g,`

`),t=t.trim(),t}renderTaskTextWithLinks(e,t){let n=this.stripMarkdown(e)||"",i=[{type:"wiki",regex:/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g},{type:"md",regex:/\[([^\]]+)\]\(([^)]+)\)/g},{type:"url",regex:/\bhttps?:\/\/[^\s)]+/g},{type:"tag",regex:/#([^\s\])[}{>]+)/g}],o=0;for(;o<n.length;){let a=null;for(let r of i){r.regex.lastIndex=o;let l=r.regex.exec(n);l&&(!a||l.index<a.match.index)&&(a={type:r.type,match:l})}if(!a){t.appendText(n.slice(o));break}if(a.match.index>o&&t.appendText(n.slice(o,a.match.index)),a.type==="tag"){let r=t.createEl("span",{cls:"todo-tag"}),l=a.match[0];r.setText(l),r.setAttribute("title",l)}else{let r=t.createEl("span",{cls:"todo-link-like"});if(a.type==="wiki"){let l=a.match[1],c=a.match[2];r.setText(c!=null?c:l),r.setAttribute("title",l)}else if(a.type==="md"){let l=a.match[1],c=a.match[2];r.setText(l),r.setAttribute("title",c)}else{let l=a.match[0];r.setText(l),r.setAttribute("title",l)}}o=a.match.index+a.match[0].length}}async openTaskLocation(e,t){var k,m,C,T,E;let n=this.app.vault.getAbstractFileByPath(t.path);if(!(n instanceof b.TFile))return;let{workspace:i}=this.app,o=b.Platform.isMacOS,a=e.button===1,r=o?e.metaKey:e.ctrlKey,l=w=>{var v,D;return w?w.view instanceof b.MarkdownView?!0:((D=(v=w.view)==null?void 0:v.getViewType)==null?void 0:D.call(v))==="markdown":!1},c=w=>w?w.view instanceof U:!1,d=()=>{let w=i.getLeavesOfType("markdown");for(let v of w)if(!c(v)&&v.view instanceof b.MarkdownView){let D=v.view.file;if(D&&D.path===n.path)return v}return null},g=()=>d(),u=a||r,p=e.shiftKey,h=null;if(p){let w=d();w?h=w:(h=i.getLeaf("split"),(c(h)||!l(h))&&(h=(k=g())!=null?k:i.getLeaf("tab")))}else u?(h=i.getLeaf("tab"),(c(h)||!l(h))&&(h=(m=g())!=null?m:i.getLeaf("tab"))):(h=d(),h||(h=g()),h||(h=i.getLeaf("tab")),c(h)&&(h=(C=g())!=null?C:i.getLeaf("tab")));if(await h.openFile(n),e.altKey){try{(T=h.setPinned)==null||T.call(h,!0)}catch(w){}try{h.pinned=!0}catch(w){}}if(h.view instanceof b.MarkdownView){let w=h.view,v=w.editor,D={line:t.line,ch:0};v.setCursor(D);try{(E=w.setEphemeralState)==null||E.call(w,{line:t.line,col:0})}catch(F){}v.scrollIntoView({from:D,to:D},!0)}await i.revealLeaf(h)}async onClose(){var t;let e=this._searchKeyHandler;e&&(window.removeEventListener("keydown",e),this._searchKeyHandler=void 0),this.optionsDropdown&&(this.optionsDropdown.cleanup(),this.optionsDropdown=null),this.suggestionDropdown&&(this.suggestionDropdown.cleanup(),this.suggestionDropdown=null),this.searchInputEl=null,await((t=super.onClose)==null?void 0:t.call(this))}};U.viewType="todoseq-view";var M=U;var P=require("obsidian");var O={singleLine:/\/\//,multiLineStart:/\/\*{1,2}/,multiLineEnd:/\*\//,multilineMid:void 0},K={singleLine:/#/,multiLineStart:void 0,multiLineEnd:void 0,multilineMid:void 0},Ce={name:"c",keywords:["c"],patterns:O},Ae={name:"cpp",keywords:["cpp","c++"],patterns:O},Me={name:"csharp",keywords:["csharp","cs"],patterns:{...O,singleLine:/\/\/\/?/}},Pe={name:"dockerfile",keywords:["dockerfile"],patterns:K},Ie={name:"go",patterns:O},Ne={name:"ini",keywords:["ini"],patterns:{singleLine:/[;#]/,multiLineStart:void 0,multiLineEnd:void 0,multilineMid:void 0}},Oe={name:"java",patterns:O},Fe={name:"javascript",keywords:["javascript","js"],patterns:O},Re={name:"kotlin",keywords:["kotlin"],patterns:O},$e={name:"powershell",keywords:["powershell"],patterns:{singleLine:/#/,multiLineStart:/<#/,multiLineEnd:/#>/}},Ve={name:"python",keywords:["python","py"],patterns:{singleLine:/#/,multiLineStart:/'''|"""/,multiLineEnd:/'''|"""/}},_e={name:"r",keywords:["r"],patterns:K},Be={name:"ruby",patterns:{singleLine:/#/,multiLineStart:/=begin/,multiLineEnd:/=end/}},We={name:"rust",keywords:["rust"],patterns:{singleLine:/\/\/[/!]?/,multiLineStart:/\/\*\*?/,multiLineEnd:/\*\//}},He={name:"shell",keywords:["shell","sh","bash"],patterns:K},Ue={name:"sql",patterns:{singleLine:/--/,multiLineStart:/\/\*+/,multiLineEnd:/\*\//}},Ke={name:"swift",keywords:["swift"],patterns:{...O,singleLine:/^\s*\/\/\/?\s+/}},Ge={name:"toml",keywords:["toml"],patterns:K},qe={name:"typescript",keywords:["typescript","ts"],patterns:O},Ye={name:"yaml",keywords:["yaml","yml"],patterns:K},z=class{constructor(){this.languages=new Map;this.keywordToLanguage=new Map;this.registerDefaultLanguages()}registerDefaultLanguages(){this.registerLanguage(Ce),this.registerLanguage(Ae),this.registerLanguage(Me),this.registerLanguage(Pe),this.registerLanguage(Ie),this.registerLanguage(Ne),this.registerLanguage(Oe),this.registerLanguage(Fe),this.registerLanguage(Re),this.registerLanguage($e),this.registerLanguage(Ve),this.registerLanguage(_e),this.registerLanguage(Be),this.registerLanguage(We),this.registerLanguage(He),this.registerLanguage(Ue),this.registerLanguage(Ke),this.registerLanguage(Ge),this.registerLanguage(qe),this.registerLanguage(Ye)}registerLanguage(s){this.languages.set(s.name.toLowerCase(),s),s.keywords&&s.keywords.forEach(e=>{this.keywordToLanguage.set(e.toLowerCase(),s)})}getLanguage(s){return s&&this.languages.get(s.toLowerCase())||null}getLanguageByKeyword(s){return s&&this.keywordToLanguage.get(s.toLowerCase())||null}getLanguageByIdentifier(s){return this.getLanguage(s)||this.getLanguageByKeyword(s)}};var je=[{type:"DATE_WITH_DOW",regex:/^<(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\s+(\d{2}:\d{2})>/,hasTime:!0,hasDayOfWeek:!0},{type:"DATE_WITH_DOW_ONLY",regex:/^<(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun)>/,hasTime:!1,hasDayOfWeek:!0},{type:"DATE_WITH_TIME",regex:/^<(\d{4}-\d{2}-\d{2})\s+(\d{2}:\d{2})>/,hasTime:!0,hasDayOfWeek:!1},{type:"DATE_ONLY",regex:/^<(\d{4}-\d{2}-\d{2})>/,hasTime:!1,hasDayOfWeek:!1}],Q=class{static parseDateTimeString(s,e){let[t,n,i]=s.split("-").map(Number),[o,a]=e.split(":").map(Number);return new Date(t,n-1,i,o,a)}static parseDateString(s){let[e,t,n]=s.split("-").map(Number);return new Date(e,t-1,n,0,0,0,0)}static parseDate(s){for(let e of je){let t=e.regex.exec(s);if(t){let n=t[1];if(e.hasTime){let i=e.type==="DATE_WITH_DOW"?t[3]:t[2];return this.parseDateTimeString(n,i)}else return this.parseDateString(n)}}return null}};var ge=/[-*+]\s+/.source,fe=/\d+[.)]\s+/.source,me=/[A-Za-z][.)]\s+/.source,we=/\([A-Za-z0-9]+\)\s+/.source,ye=/\[[ x\S]\]\s+/.source,Xe=/\s*/.source,ze=/\s*>\s*/.source,Qe=/\s*>\s*\[!\w+\]-?\s+/.source,Te=/^\s*(```|~~~)\s*(\S+)?$/,Je=/^\s*\$\$(?!.*\$\$).*/,Ze=/^\s*%%.*%%$|^\s*%%(?!.*%%).*/,et=/^\s*>.*/,tt=/^\[\^\d+\]:\s*/,st=/\s*[\s\S]*?/.source,ce=/[\S][\s\S]*?/.source,R=class f{constructor(s,e,t,n,i,o,a){this.languageRegistry=null;this.currentLanguage=null;this.customKeywords=o,this.allKeywords=a,this.testRegex=s.test,this.captureRegex=s.capture,this.includeCalloutBlocks=e,this.includeCodeBlocks=t,this.includeCommentBlocks=n,this.languageCommentSupport=i}static create(s){let t=(Array.isArray(s.additionalTaskKeywords)?s.additionalTaskKeywords:[]).filter(r=>typeof r=="string").map(r=>r.trim()).filter(r=>r.length>0);t.length>0&&f.validateKeywords(t);let n=[...Array.from(G),...Array.from(B),...t],i=new Set(n),o=[...Array.from(i),...Array.from(I)],a=f.buildRegex(o);return new f(a,s.includeCalloutBlocks,s.includeCodeBlocks,s.includeCommentBlocks,s.languageCommentSupport,t,o)}static validateKeywords(s){let e=[/\*.*\*/,/\+.*\+/,/\?.*\?/,/\*\*\*+/,/\+\+\++/,/\?\?\?+/,/\*\{10,\}/,/\+\{10,\}/,/\?\{10,\}/,/\([^)]*\)[^)]*\\\d+/,/\(?=/,/\(?!/,/\(?<=/,/\(?<!/,/^.{50,}$/];for(let t of s){for(let n of e)if(n.test(t))throw new Error(`Invalid task keyword "${t}": contains dangerous regex pattern. Keywords should be simple words without complex regex syntax.`);if(t.length===0)throw new Error("Invalid task keyword: empty keyword not allowed");if(/^\s+$/.test(t))throw new Error(`Invalid task keyword "${t}": whitespace-only keywords not allowed`)}}static escapeKeywords(s){return s.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")}static buildRegex(s){let e=f.escapeKeywords(s),t=new RegExp(`^(${Xe}|${ze}|${Qe})?(${ge}|${fe}|${me}|${we})??(${ye})?(${e})\\s+(${ce})$`);return{test:t,capture:t}}static buildFootnoteRegex(s){let e=f.escapeKeywords(s),t="\\[\\^\\d+\\]:\\s+",n=new RegExp(`^${t}(${e})\\s+(${ce})$`);return{test:n,capture:n}}static buildCodeRegex(s,e){var l,c,d,g;let t=f.escapeKeywords(s),n=[(l=e.patterns.singleLine)==null?void 0:l.source,(c=e.patterns.multiLineStart)==null?void 0:c.source].filter(Boolean).join("|"),i=((d=e.patterns.multilineMid)==null?void 0:d.source)||".*?",o=`\\s+${(g=e.patterns.multiLineEnd)==null?void 0:g.source}\\s*`||"",a=new RegExp(`^((?:(?:${st})?(?:(?:${n})\\s+))|(?:${i}\\s*))(${ge}|${fe}|${me}|${we})??(${ye})?(${t})\\s+(${ce})(?=${o}$|$)?(${o})?$`);return{test:a,capture:a}}extractFootnoteTaskDetails(s,e){let t=e.exec(s);if(!t)throw new Error(`Failed to parse footnote task line: ${s}`);let n="",i="",o=t[1],a=t[2];return{indent:n,listMarker:i,taskText:a,tail:"",state:o}}extractTaskDetails(s,e){let t=e.exec(s);if(!t)throw new Error(`Failed to parse task line: ${s}`);let n=t[1]||"",i=(t[2]||"")+(t[3]||""),o=t[4],a=t[5],r=t[6];return{indent:n,listMarker:i,taskText:a,tail:r,state:o}}extractPriority(s){let e=null,t=s,n=/(\s*)\[#([ABC])\](\s*)/.exec(t);if(n){let i=n[2];i==="A"?e="high":i==="B"?e="med":i==="C"&&(e="low");let o=t.slice(0,n.index),a=t.slice(n.index+n[0].length);t=(o+" "+a).replace(/[ \t]+/g," ").trimStart()}return{priority:e,cleanedText:t}}extractCheckboxState(s,e,t){let n=e,i=I.has(e),o=t,a=s.match(/^(\s*)([-*+]\s*\[(\s|x)\]\s*)\s+([^\s]+)\s+(.+)$/);if(!a&&s.startsWith(">")&&(a=s.substring(1).match(/^(\s*)([-*+]\s*\[(\s|x)\]\s*)\s+([^\s]+)\s+(.+)$/)),a){let[,,r,l,c]=a;n=c,i=l==="x",o=r.trimEnd()}return{state:n,completed:i,listMarker:o}}getDateLineType(s,e){let t=s.trim();if(s.startsWith(">")){let i=t.substring(1).trim();if(i.startsWith("SCHEDULED:")||i.startsWith("DEADLINE:"))return i.startsWith("SCHEDULED:")?"scheduled":"deadline"}if(!t.startsWith("SCHEDULED:")&&!t.startsWith("DEADLINE:"))return null;let n=s.substring(0,s.length-t.length);return n!==e&&!n.startsWith(e)?null:t.startsWith("SCHEDULED:")?"scheduled":"deadline"}parseDateFromLine(s){let e=s.replace(/^\s*>\s*(SCHEDULED|DEADLINE):\s*/,"").replace(/^\s*(SCHEDULED|DEADLINE):\s*/,"").trim();return Q.parseDate(e)}extractTaskDates(s,e,t){let n=null,i=null,o=!1,a=!1;for(let r=e;r<s.length;r++){let l=s[r];if(l.trim()==="")continue;let d=this.getDateLineType(l,t);if(d==="scheduled"&&!o){let g=this.parseDateFromLine(l);g?(n=g,o=!0):console.warn(`Invalid scheduled date format at line ${r+1}: "${l.trim()}"`)}else if(d==="deadline"&&!a){let g=this.parseDateFromLine(l);g?(i=g,a=!0):console.warn(`Invalid deadline date format at line ${r+1}: "${l.trim()}"`)}else if(d===null||o&&a)break}return{scheduledDate:n,deadlineDate:i}}parseFile(s,e){let t=s.split(`
`),n=!1,i=null,o=null,a=[];for(let r=0;r<t.length;r++){let l=t[r];if(l.trim()=="")continue;if(tt.test(l)){let E=f.buildFootnoteRegex(this.allKeywords);if(E.test.test(l)){let w=this.extractFootnoteTaskDetails(l,E.capture),{priority:v,cleanedText:D}=this.extractPriority(w.taskText),F={path:e,line:r,rawText:l,indent:w.indent,listMarker:w.listMarker,text:D,state:w.state,completed:I.has(w.state),priority:v,scheduledDate:null,deadlineDate:null,tail:w.tail},{scheduledDate:_,deadlineDate:S}=this.extractTaskDates(t,r+1,w.indent);F.scheduledDate=_,F.deadlineDate=S,a.push(F)}continue}if(Te.test(l)){if(!n&&this.includeCodeBlocks&&this.languageCommentSupport.enabled){let E=Te.exec(l);this.detectLanguage(E?E[2]:""),this.currentLanguage?o=f.buildCodeRegex(this.allKeywords,this.currentLanguage):o=null}n=!n,i=n?"code":null;continue}else if(Je.test(l))n=!n,i=n?"math":null;else if(Ze.test(l))if(/^\s*%%.*%%$/.test(l)){if(this.includeCommentBlocks){let v=l.replace(/^\s*%%\s*/,"").replace(/\s*%%$/,"");if(this.testRegex.test(v)){let D=this.extractTaskDetails(v,this.captureRegex),{priority:F,cleanedText:_}=this.extractPriority(D.taskText),{state:S,completed:A,listMarker:ee}=this.extractCheckboxState(v,D.state,D.listMarker),te={state:S,completed:A,text:_,priority:F,rawText:v.trim(),path:e,line:r+1,indent:D.indent,listMarker:ee,scheduledDate:null,deadlineDate:null,tail:D.tail},{scheduledDate:Ee,deadlineDate:ve}=this.extractTaskDates(t,r+1,D.indent);te.scheduledDate=Ee,te.deadlineDate=ve,a.push(te)}}}else n=!n,i=n?"comment":null;if(!this.includeCalloutBlocks&&et.test(l)||n&&!this.includeCodeBlocks&&i==="code"||n&&i==="math"||n&&i==="comment"&&!this.includeCommentBlocks)continue;let c=n&&this.includeCodeBlocks&&i=="code"&&this.currentLanguage;if(c&&o){if(!o.test.test(l))continue}else if(!this.testRegex.test(l))continue;let d=this.extractTaskDetails(l,c&&o?o.capture:this.captureRegex),{priority:g,cleanedText:u}=this.extractPriority(d.taskText),{state:p,completed:h,listMarker:k}=this.extractCheckboxState(l,d.state,d.listMarker),m={path:e,line:r,rawText:l,indent:d.indent,listMarker:k,text:u,state:p,completed:h,priority:g,scheduledDate:null,deadlineDate:null,tail:d.tail},{scheduledDate:C,deadlineDate:T}=this.extractTaskDates(t,r+1,d.indent);m.scheduledDate=C,m.deadlineDate=T,a.push(m)}return a}detectLanguage(s){this.currentLanguage=this.getLanguageRegistry().getLanguageByIdentifier(s)}getLanguageRegistry(){return this.languageRegistry||(this.languageRegistry=new z),this.languageRegistry}};var De={refreshInterval:60,additionalTaskKeywords:[],includeCodeBlocks:!1,includeCalloutBlocks:!0,includeCommentBlocks:!1,taskViewMode:"showAll",languageCommentSupport:{enabled:!0},weekStartsOn:"Monday"},J=class extends P.PluginSettingTab{constructor(e,t){super(e,t);this.refreshAllTaskViews=async()=>{let e=this.app.workspace.getLeavesOfType(M.viewType);for(let t of e)if(t.view instanceof M){t.view.tasks=this.plugin.tasks;let n=this.plugin.settings.taskViewMode;t.view.setViewMode(n),await t.view.onOpen()}};this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new P.Setting(e).setName("Refresh interval").setDesc("How often to rescan the vault for TODOs (in seconds)").addSlider(a=>a.setLimits(10,300,10).setValue(this.plugin.settings.refreshInterval).setDynamicTooltip().onChange(async r=>{this.plugin.settings.refreshInterval=r,await this.plugin.saveSettings(),this.plugin.setupPeriodicRefresh(),await this.refreshAllTaskViews()})),new P.Setting(e).setName("Additional task Keywords").setDesc("Capitalised list of keywords for treat as tasks (e.g. FIXME, HACK). Leave empty for none.").addText(a=>{var l;let r=(l=this.plugin.settings.additionalTaskKeywords)!=null?l:[];a.setValue(r.join(", ")).onChange(async c=>{let d=c.toUpperCase();if(d!==c)try{a.setValue(d)}catch(T){}let g=d.split(",").map(T=>T.trim()).filter(T=>T.length>0),u=a.inputEl.closest(".setting-item");if(!u){console.error("Could not find setting container");return}let p=u.querySelector(".setting-item-info");if(!p){console.error("Could not find setting info container");return}let h=u.querySelector(".todoseq-setting-item-error");h&&(h.remove(),a.inputEl.classList.remove("todoseq-invalid-input"));let k=[],m=[],C=[];for(let T of g)try{let E={additionalTaskKeywords:[T],includeCalloutBlocks:this.plugin.settings.includeCalloutBlocks,includeCodeBlocks:this.plugin.settings.includeCodeBlocks,languageCommentSupport:this.plugin.settings.languageCommentSupport};R.validateKeywords([T]),k.push(T)}catch(E){m.push(T),C.push(`"${T}": ${E.message}`)}if(m.length>0){let T=document.createElement("div");T.className="todoseq-setting-item-error",T.textContent=`Invalid keyword ${m.join(", ")} will be ignored.`,a.inputEl.classList.add("todoseq-invalid-input"),p.appendChild(T),this.plugin.settings.additionalTaskKeywords=k,await this.plugin.saveSettings();try{this.plugin.recreateParser(),await this.plugin.scanVault(),await this.refreshAllTaskViews()}catch(E){console.error("Failed to recreate parser with valid keywords:",E)}}else this.plugin.settings.additionalTaskKeywords=g,await this.plugin.saveSettings(),this.plugin.recreateParser(),await this.plugin.scanVault(),await this.refreshAllTaskViews()})});let t=null;new P.Setting(e).setName("Include tasks inside code blocks").setDesc("When enabled, tasks inside fenced code blocks (``` or ~~~) will be included.").addToggle(a=>a.setValue(this.plugin.settings.includeCodeBlocks).onChange(async r=>{this.plugin.settings.includeCodeBlocks=r,r||(this.plugin.settings.languageCommentSupport.enabled=!1),await this.plugin.saveSettings(),t&&t.setValue(this.plugin.settings.languageCommentSupport.enabled),i.setDisabled(!r),this.plugin.recreateParser(),await this.plugin.scanVault(),await this.refreshAllTaskViews()}));let n=e.createDiv(),i=new P.Setting(n).setName("Enable language comment support").setDesc("When enabled, tasks inside code blocks will be detected using language-specific comment patterns e.g. `// TODO`").addToggle(a=>(t=a,a.setValue(this.plugin.settings.languageCommentSupport.enabled).onChange(async r=>{this.plugin.settings.languageCommentSupport.enabled=r,await this.plugin.saveSettings(),this.plugin.recreateParser(),await this.plugin.scanVault(),await this.refreshAllTaskViews()})));i.setDisabled(!this.plugin.settings.includeCodeBlocks),(a=>{let r=i.settingEl.querySelector('input[type="checkbox"]');r&&(r.checked=a),i.setDisabled(!a)})(this.plugin.settings.includeCodeBlocks),new P.Setting(e).setName("Include tasks inside quote and callout blocks").setDesc("When enabled, include tasks inside quote and callout blocks (>, >[!info], >[!todo], etc.)").addToggle(a=>a.setValue(this.plugin.settings.includeCalloutBlocks).onChange(async r=>{this.plugin.settings.includeCalloutBlocks=r,await this.plugin.saveSettings(),this.plugin.recreateParser(),await this.plugin.scanVault(),await this.refreshAllTaskViews()})),new P.Setting(e).setName("Include tasks inside comment blocks").setDesc("When enabled, include tasks inside multiline comment blocks ($$).").addToggle(a=>a.setValue(this.plugin.settings.includeCommentBlocks).onChange(async r=>{this.plugin.settings.includeCommentBlocks=r,await this.plugin.saveSettings(),this.plugin.recreateParser(),await this.plugin.scanVault(),await this.refreshAllTaskViews()})),new P.Setting(e).setName("Task View mode").setDesc("Choose how completed items are shown in the task view.").addDropdown(a=>{a.addOption("showAll","Show all tasks"),a.addOption("sortCompletedLast","Sort completed to end"),a.addOption("hideCompleted","Hide completed"),a.setValue(this.plugin.settings.taskViewMode),a.onChange(async r=>{let l=r;this.plugin.settings.taskViewMode=l,await this.plugin.saveSettings(),await this.refreshAllTaskViews()})}),new P.Setting(e).setName("Week starts on").setDesc("Choose which day the week starts on for date filtering.").addDropdown(a=>{a.addOption("Monday","Monday"),a.addOption("Sunday","Sunday"),a.setValue(this.plugin.settings.weekStartsOn),a.onChange(async r=>{let l=r;this.plugin.settings.weekStartsOn=l,await this.plugin.saveSettings(),await this.refreshAllTaskViews()})})}};var X="list-todo",Z=class extends V.Plugin{constructor(){super(...arguments);this.tasks=[];this.parser=null;this.taskEditor=null;this.taskComparator=(e,t)=>e.path===t.path?e.line-t.line:e.path.localeCompare(t.path);this._isScanning=!1}async onload(){await this.loadSettings(),this.registerView(M.viewType,t=>new M(t,this.tasks,this.settings.taskViewMode,this.settings));let e=async t=>{let n=t.detail;n!=null&&n.mode&&(this.settings.taskViewMode=n.mode,await this.saveSettings(),await this.refreshOpenTaskViews())};window.addEventListener("todoseq:view-mode-change",e),this.register(()=>window.removeEventListener("todoseq:view-mode-change",e)),this.addRibbonIcon(X,"Open TODOseq",()=>{this.showTasks()}),this.addSettingTab(new J(this.app,this)),this.addCommand({id:"show-todo-tasks",name:"Show TODO tasks",callback:()=>this.showTasks()}),this.addCommand({id:"toggle-task-state",name:"Toggle task state",editorCheckCallback:(t,n,i)=>this.handleToggleTaskState(t,n,i),hotkeys:[{modifiers:["Ctrl"],key:"Enter"}]}),this.taskEditor=new $(this.app),await this.scanVault(),await this.refreshOpenTaskViews(),this.setupPeriodicRefresh(),this.registerEvent(this.app.vault.on("modify",t=>this.handleFileChange(t))),this.registerEvent(this.app.vault.on("delete",t=>this.handleFileChange(t))),this.registerEvent(this.app.vault.on("create",t=>this.handleFileChange(t))),this.registerEvent(this.app.vault.on("rename",(t,n)=>this.handleFileRename(t,n)))}async refreshOpenTaskViews(){let e=this.app.workspace.getLeavesOfType(M.viewType);for(let t of e)t.view instanceof M&&(t.view.tasks=this.tasks,t.view.updateTasks(this.tasks),t.view.refreshVisibleList())}onunload(){window.clearInterval(this.refreshIntervalId)}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},De,e),this.settings.additionalTaskKeywords||(this.settings.additionalTaskKeywords=[]),this.recreateParser()}recreateParser(){this.parser=R.create(this.settings)}async saveSettings(){await this.saveData(this.settings)}setupPeriodicRefresh(){window.clearInterval(this.refreshIntervalId),this.refreshIntervalId=window.setInterval(async()=>{if(!this._isScanning){this._isScanning=!0;try{await this.scanVault(),await this.refreshOpenTaskViews()}catch(e){console.error("TODOseq periodic scan error",e)}finally{this._isScanning=!1}}},this.settings.refreshInterval*1e3)}async yieldToEventLoop(){await new Promise(e=>requestAnimationFrame(()=>e()))}async scanVault(){if(!this._isScanning){this._isScanning=!0;try{this.tasks=[];let e=this.app.vault.getFiles(),t=20,n=0;for(let i of e)i.extension==="md"&&(await this.scanFile(i),n++,n%t===0&&await this.yieldToEventLoop());this.tasks.sort(this.taskComparator)}finally{this._isScanning=!1}}}async scanFile(e){let t=await this.app.vault.read(e);this.parser||(this.parser=R.create(this.settings));let n=this.parser.parseFile(t,e.path);this.tasks.push(...n)}async handleFileChange(e){try{if(!(e instanceof V.TFile)||e.extension!=="md")return;this.tasks=this.tasks.filter(n=>n.path!==e.path),this.app.vault.getAbstractFileByPath(e.path)instanceof V.TFile&&await this.scanFile(e),this.tasks.sort(this.taskComparator),await this.refreshOpenTaskViews()}catch(t){console.error("TODOseq handleFileChange error",t);try{await this.refreshOpenTaskViews()}catch(n){}}}async handleFileRename(e,t){try{this.tasks=this.tasks.filter(n=>n.path!==t),e instanceof V.TFile&&await this.scanFile(e),this.tasks.sort(this.taskComparator),await this.refreshOpenTaskViews()}catch(n){console.error("TODOseq handleFileRename error",n);try{await this.refreshOpenTaskViews()}catch(i){}}}async showTasks(){let{workspace:e}=this.app,t=null,n=e.getLeavesOfType(M.viewType);n.length>0?(t=n[0],e.activeLeaf!==t&&await e.revealLeaf(t)):(t=e.getLeaf(!0),t.setViewState({type:M.viewType,active:!0}),e.activeLeaf!==t&&await e.revealLeaf(t))}handleToggleTaskState(e,t,n){var r,l;if(!this.taskEditor)return!1;let i=t.getCursor(),o=t.getLine(i.line);if(!((r=this.parser)!=null&&r.testRegex.test(o)))return!1;if(e)return!0;let a=this.parseTaskFromLine(o,i.line,((l=n.file)==null?void 0:l.path)||"");return a&&this.taskEditor.updateTaskState(a),!0}parseTaskFromLine(e,t,n){if(!this.parser)return null;let i=this.parser.captureRegex.exec(e);if(!i)return null;let o=i[1]||"",a=(i[2]||"")+(i[3]||""),r=i[4],l=i[5],c=i[6],d=null,g=l.replace(/(\s*)\[#([ABC])\](\s*)/,(h,k,m,C)=>(m==="A"?d="high":m==="B"?d="med":m==="C"&&(d="low")," ")).replace(/[ \t]+/g," ").trimStart(),u=!1,p=e.match(/^(\s*)([-*+]\s*\[(\s|x)\]\s*)\s+([^\s]+)\s+(.+)$/);if(p){let[,,,h]=p;u=h==="x"}else u=new Set(["DONE","CANCELED","CANCELLED"]).has(r);return{path:n,line:t,rawText:e,indent:o,listMarker:a,text:g,state:r,completed:u,priority:d,scheduledDate:null,deadlineDate:null,tail:c}}};

/* nosourcemap */